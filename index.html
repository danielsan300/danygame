const NGROK_URL = "https://nicky-quixotic-uncomplacently.ngrok-free.dev";

async function caricaPannelloAdmin() {
    const myId = window.Telegram.WebApp.initDataUnsafe.user.id;
    
    try {
        const response = await fetch(`${NGROK_URL}/api/admin_panel?id=${myId}`);
        
        if (response.status === 403) {
            return;
        }

        const utenti = await response.json();
        let html = '<h3>DATABASE UTENTI</h3>';

        utenti.forEach(u => {
            html += `
                <div class="card" style="border-left: 4px solid #ff00ff; margin-bottom:10px; padding:10px;">
                    <div style="display:flex; justify-content:space-between;">
                        <b>${u.nome}</b> 
                        <span style="color:#ffcf33">â‚¬ ${u.saldo.toFixed(2)}</span>
                    </div>
                    <div style="margin-top:5px; font-size:10px; opacity:0.6;">ID: ${u.id}</div>
                </div>`;
        });

        document.getElementById('dynamic-user-list').innerHTML = html;
        document.getElementById('admin-tab').style.display = 'block';

    } catch (e) {
        console.error("Server Offline");
    }
}

setInterval(caricaPannelloAdmin, 10000);
caricaPannelloAdmin();
