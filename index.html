<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>DanielSant â€” Arena Dashboard</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background: url('bg_arena.png') no-repeat center center fixed;
        background-size: cover;
        font-family: 'Consolas', monospace;
        color: #00ff9f;
        overflow: hidden;
    }
    #nav {
        background: url('nav_arena.png') no-repeat center;
        background-size: contain;
        height: 80px;
        width: 100%;
        margin-bottom: 20px;
    }
    #logo {
        background: url('logo.png') no-repeat center;
        background-size: contain;
        height: 100px;
        width: 100%;
        margin-top: 10px;
    }
    .box {
        background: rgba(0, 0, 0, 0.7);
        border: 1px solid #00ff9f;
        box-shadow: 0 0 15px #00ff9f;
        padding: 20px;
        margin: 20px auto;
        width: 80%;
        max-width: 900px;
        text-align: center;
    }
    h1 {
        color: #00ffaa;
        text-shadow: 0 0 10px #00ffaa;
        margin-bottom: 10px;
    }
    canvas {
        margin-top: 20px;
    }
</style>
</head>
<body>

<div id="nav"></div>
<div id="logo"></div>

<div class="box">
    <h1>âš¡ DanielSant â€” Arena Dashboard</h1>
    <p id="users">Utenti: ...</p>
    <p id="contracts">Contratti: ...</p>
    <p id="capital">Capitale Totale: ...</p>
    <p id="power">Potenza Rete: ...</p>
    <p id="generated">Crediti Generati: ...</p>
</div>

<div class="box">
    <h2>ðŸŒŒ Andamento Crediti Generati</h2>
    <canvas id="creditsChart" width="800" height="300"></canvas>
</div>

<audio id="clickSound" src="sound_clik.mp3" preload="auto"></audio>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let chart;
let labels = [];
let values = [];

function initChart() {
    const ctx = document.getElementById('creditsChart').getContext('2d');
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Crediti Generati',
                data: values,
                borderColor: '#00ff9f',
                backgroundColor: 'rgba(0, 255, 159, 0.15)',
                borderWidth: 2,
                tension: 0.3,
                pointRadius: 3,
                pointBackgroundColor: '#00ffaa',
                pointBorderColor: '#00ffaa'
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    labels: {
                        color: '#00ff9f'
                    }
                }
            },
            scales: {
                x: {
                    ticks: { color: '#00ff9f' },
                    grid: { color: 'rgba(0,255,159,0.1)' }
                },
                y: {
                    ticks: { color: '#00ff9f' },
                    grid: { color: 'rgba(0,255,159,0.1)' }
                }
            }
        }
    });
}

function updateData() {
    fetch("/api/overview")
        .then(r => r.json())
        .then(data => {
            document.getElementById("users").innerText = "Utenti: " + data.users;
            document.getElementById("contracts").innerText = "Contratti: " + data.contracts;
            document.getElementById("capital").innerText = "Capitale Totale: " + data.capital + "â‚¬";
            document.getElementById("power").innerText = "Potenza Rete: " + data.network_power;
            document.getElementById("generated").innerText = "Crediti Generati: " + data.generated_credits;

            const now = new Date();
            const label = now.toLocaleTimeString();

            labels.push(label);
            values.push(data.generated_credits);

            if (labels.length > 30) {
                labels.shift();
                values.shift();
            }

            chart.update();

            document.getElementById("clickSound").play();
        });
}

initChart();
setInterval(updateData, 2000);
updateData();
</script>

</body>
</html>
